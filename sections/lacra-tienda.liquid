<div class="container mx-auto px-8 md:px-0">
  {% if section.settings.title != blank %}
    <h2 class="text-[27px] md:text-[40px] text-black dark:text-[#feffee] font-medium mb-2 tracking-tight">
      {{ section.settings.title }}
    </h2>
{% endif %}

  {%- comment -%} Hero imágenes dinámicas con enlace opcional {%- endcomment -%}
  {% assign desktop_img = section.settings.hero_image_desktop %}
  {% assign mobile_img = section.settings.hero_image_mobile %}
  {% assign hero_alt = section.settings.hero_image_alt %}
  {% if section.settings.hero_link_url != blank %}
    <a href="{{ section.settings.hero_link_url }}" class="block">
  {% endif %}
  {% if desktop_img != blank %}
    <img
      src="{{ desktop_img | image_url: width: 1600 }}"
      srcset="{{ desktop_img | image_url: width: 800 }} 800w, {{ desktop_img | image_url: width: 1200 }} 1200w, {{ desktop_img | image_url: width: 1600 }} 1600w, {{ desktop_img | image_url: width: 2000 }} 2000w"
      sizes="(min-width: 1024px) 100vw, 100vw"
      alt="{{ hero_alt | default: 'Imagen destacada' }}"
      class="rounded-md hidden md:block"
      width="1600"
      height="900">
  {% endif %}
  {% if mobile_img != blank %}
    <img
      src="{{ mobile_img | image_url: width: 900 }}"
      srcset="{{ mobile_img | image_url: width: 400 }} 400w, {{ mobile_img | image_url: width: 600 }} 600w, {{ mobile_img | image_url: width: 900 }} 900w"
      sizes="(max-width: 767px) 100vw, 100vw"
      alt="{{ hero_alt | default: 'Imagen destacada' }}"
      class="rounded-md block md:hidden"
      width="900"
      height="1200">
  {% endif %}
  {% if section.settings.hero_link_url != blank %}
    </a>
  {% endif %}

  {%- comment -%} Tienda - título dinámico {%- endcomment -%}
  {% if section.settings.tienda_title != blank %}
    <h2 class="text-[27px] md:text-[40px] text-black dark:text-[#feffee] font-medium mb-2 tracking-tight mt-8">
      {{ section.settings.tienda_title }}
    </h2>
  {% endif %}

  {%- comment -%} Grid de productos {%- endcomment -%}
  {% if section.settings.product_collection != blank %}
    {% assign collection = collections[section.settings.product_collection] %}

    <div class="flex overflow-x-scroll md:grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 pb-8 mt-7 gap-7 md:gap-4">
      {% for product in collection.products limit: 12 %}
        <a href="{{ product.url }}" class="border border-black dark:border-[#feffee] dark:bg-white/10 rounded-xl group hover:bg-white/15 transition-all">
          <div class="block w-full min-w-[300px] max-w-[300px] md:min-w-full overflow-hidden flex flex-col rounded-xl">
            {% if product.featured_image %}
              <div class="relative">
                <img
                  src="{{ product.featured_image | image_url: width: 600 }}"
                  alt="{{ product.title | escape }}"
                  class="w-full h-[170px] object-cover rounded-xl"
                  loading="lazy"
                  width="600"
                  height="340">

                {% if product.compare_at_price > product.price %}
                  <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-semibold">
                    OFERTA
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="w-full h-[170px] bg-gray-800 rounded-xl flex items-center justify-center">
                <span class="text-black dark:text-[#feffee] text-sm">Sin imagen</span>
              </div>
            {% endif %}

            <div class="flex flex-col justify-between items-start p-4">
              <h3 class="text-2xl font-semibold text-black dark:text-[#feffee] truncate w-full mb-2" title="{{ product.title | escape }}">
                {{ product.title }}
              </h3>

              <div class="flex items-center gap-2 w-full">
                {% if product.compare_at_price > product.price %}
                  <span class="text-gray-400 line-through text-sm">
                    {{ product.compare_at_price | money }}
                  </span>
                {% endif %}
                <span class="text-black dark:text-[#feffee] text-xl font-semibold">
                  {{ product.price | money }}
                </span>
              </div>

              <button class="mt-3 w-full bg-white/20 text-black dark:text-[#feffee] py-2 px-4 rounded-lg hover:bg-white/30 transition-colors text-sm font-medium">
                Ver producto
              </button>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>

    {%- comment -%} Botón ver todos los productos {%- endcomment -%}
    <div class="flex justify-center mt-8">
      <a href="{{ routes.collections_url }}/{{ section.settings.product_collection }}" class="inline-block border-2 border-black dark:border-[#feffee] text-black dark:text-[#feffee] px-8 py-3 rounded-xl hover:bg-white hover:text-black transition-all font-medium">
        Ver todos los productos
      </a>
    </div>
  {% else %}
    <p class="text-black dark:text-[#feffee] mt-4">No has seleccionado una colección todavía.</p>
  {% endif %}
</div>

{% schema %}
  {
    "name": "Lacra Tienda",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Título superior"
      },
      {
        "type": "image_picker",
        "id": "hero_image_desktop",
        "label": "Imagen hero - Desktop"
      },
      {
        "type": "image_picker",
        "id": "hero_image_mobile",
        "label": "Imagen hero - Mobile"
      },
      {
        "type": "text",
        "id": "hero_image_alt",
        "label": "Alt de imagen hero",
        "default": "Imagen destacada"
      }, {
        "type": "url",
        "id": "hero_link_url",
        "label": "URL del hero (opcional)"
      }, {
        "type": "text",
        "id": "tienda_title",
        "label": "Título - Tienda",
        "default": "Tienda"
      }, {
        "type": "collection",
        "id": "product_collection",
        "label": "Colección de productos"
      }
    ],
    "presets": [
      {
        "name": "Lacra Tienda"
      }
    ]
  }
{% endschema %}